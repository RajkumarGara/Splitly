<template name="MainLayout">
	{{> Alerts}}
	
	<!-- Universal Header with Avatar -->
	<header class="app-header" role="banner">
		<div class="app-header-inner">
			<div class="header-brand">
				<i class="bi bi-receipt-cutoff"></i>
				<span class="brand-text">Splitly</span>
			</div>
			{{#if currentUser}}
				<div class="header-user-menu">
					<div class="dropdown">
						<button class="avatar-button" type="button" id="avatarDropdown" data-bs-toggle="dropdown" aria-expanded="false" aria-label="User menu">
							<div class="avatar-circle">
								<span class="avatar-initial">{{userInitial}}</span>
							</div>
						</button>
						<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="avatarDropdown">
							{{#unless isGuestUser}}
								<li><h6 class="dropdown-header">{{userDisplayNameOrEmail}}</h6></li>
								<li><hr class="dropdown-divider"></li>
							{{/unless}}
							<li><a class="dropdown-item" href="/settings"><i class="bi bi-person"></i> Account</a></li>
							<li><hr class="dropdown-divider"></li>
							<li><a class="dropdown-item text-danger" href="#" id="headerLogoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
						</ul>
					</div>
				</div>
			{{/if}}
		</div>
	</header>
	
	<!-- Top Navigation (desktop/tablet) -->
	<nav class="top-nav" role="navigation" aria-label="Primary">
		<div class="top-nav-inner">
			<div class="top-nav-brand">
				<i class="bi bi-receipt-cutoff"></i>
				<span class="brand-text">Splitly</span>
			</div>
			<ul class="top-nav-list">
				{{#each navItems}}
					<li class="top-nav-item {{isActive path}}">
						<a href="{{path}}" class="top-nav-link">
							<i class="bi {{icon}}" aria-hidden="true"></i>
							<span class="label">{{label}}</span>
						</a>
					</li>
				{{/each}}
			</ul>
			{{#if currentUser}}
				<div class="top-nav-user">
					<div class="dropdown">
						<button class="avatar-button" type="button" id="topNavAvatarDropdown" data-bs-toggle="dropdown" aria-expanded="false" aria-label="User menu">
							<div class="avatar-circle">
								<span class="avatar-initial">{{userInitial}}</span>
							</div>
						</button>
						<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="topNavAvatarDropdown">
							{{#unless isGuestUser}}
								<li><h6 class="dropdown-header">{{userDisplayNameOrEmail}}</h6></li>
								<li><hr class="dropdown-divider"></li>
							{{/unless}}
							<li><a class="dropdown-item" href="/settings"><i class="bi bi-person"></i> Account</a></li>
							<li><hr class="dropdown-divider"></li>
							<li><a class="dropdown-item text-danger" href="#" id="topNavLogoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
						</ul>
					</div>
				</div>
			{{/if}}
		</div>
	</nav>

	<div class="container pb-5 pb-lg-4">
		{{#if notReady}}
			<div class="text-center py-5">
				<div class="spinner-border text-purple" role="status"><span class="visually-hidden">Loading</span></div>
				<div class="mt-3 text-muted">Syncing bills...</div>
			</div>
		{{else}}
			<div class="page-content">
				{{> Template.dynamic template=yield}}
			</div>
		{{/if}}
	</div>

	<!-- Bottom Navigation (mobile only) -->
	<nav class="mobile-nav" role="navigation" aria-label="Primary (mobile)">
		<div class="mobile-nav-container">
			{{#each navItems}}
				<a href="{{path}}" class="mobile-nav-item {{isActive path}}" aria-label="{{label}}">
					<i class="bi {{icon}}" aria-hidden="true"></i>
					<span>{{label}}</span>
				</a>
			{{/each}}
		</div>
	</nav>

	{{> UserModal}}
	{{> ConfirmModal}}
</template>

<template name="Alerts">
	<div class="position-fixed top-0 end-0 p-3 alerts-container">
		{{#each alerts}}
			<div class="alert alert-{{typeClass}} alert-dismissible fade show" role="alert">
				{{msg}}
				<button type="button" class="btn-close" data-id="{{id}}"></button>
			</div>
		{{/each}}
	</div>
</template>

<template name="ConfirmModal">
	<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p class="mb-0" id="confirmModalMessage">Are you sure?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" id="confirmCancelBtn">Cancel</button>
					<button type="button" class="btn btn-danger" id="confirmOkBtn">Yes, Proceed</button>
				</div>
			</div>
		</div>
	</div>
</template>